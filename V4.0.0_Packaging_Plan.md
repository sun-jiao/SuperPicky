# SuperPicky V4.0.0 æ‰“åŒ…è®¡åˆ’

**ç‰ˆæœ¬**: 4.0.0  
**Commit Hash**: 0f6b496  
**æ›´æ–°æ—¥æœŸ**: 2026-01-18  
**ç›®æ ‡**: PKG + DMG æ ¼å¼çš„å®Œæ•´å®‰è£…åŒ…

---

## ğŸ“‹ ç‰ˆæœ¬æ›´æ–°æ£€æŸ¥æ¸…å•

### âœ… å·²æ›´æ–°çš„æ–‡ä»¶

| æ–‡ä»¶ | ç‰ˆæœ¬å· | çŠ¶æ€ |
|------|--------|------|
| `constants.py` | 4.0.0 | âœ… |
| `update_checker.py` | 4.0.0 | âœ… |
| `ui/about_dialog.py` | v4.0.0 | âœ… |
| `ui/main_window.py` | V4.0.0 | âœ… |
| `locales/zh_CN.json` | 4.0.0 | âœ… |
| `locales/en_US.json` | 4.0.0 | âœ… |
| `README.md` (å¾½ç« ) | 4.0.0 | âœ… |
| `SuperBirdIDPlugin.lrplugin/Info.lua` | 4.0.0 | âœ… |
| `SuperBirdIDPlugin.lrplugin/PluginInit.lua` | v4.0.0 | âœ… |
| `SuperBirdIDPlugin.lrplugin/SuperBirdIDExportServiceProvider.lua` | v4.0.0 | âœ… |

---

## ğŸ“¦ æ‰“åŒ…å†…å®¹

### 1ï¸âƒ£ å¿…é¡»æ‰“åŒ…çš„æ ¸å¿ƒæ–‡ä»¶

| ç±»åˆ« | æ–‡ä»¶/ç›®å½• | è¯´æ˜ |
|------|----------|------|
| **ä¸»ç¨‹åº** | `main.py` | å…¥å£ |
| **æ ¸å¿ƒé€»è¾‘** | `core/` | è¯„åˆ†ã€å¤„ç†é€»è¾‘ |
| **UIç•Œé¢** | `ui/` | PySide6 GUI |
| **è¯†é¸Ÿæ¨¡å—** | `birdid/` | é¸Ÿç±»è¯†åˆ«æ ¸å¿ƒ |
| **è¯†é¸ŸAPI** | `birdid_server.py` | Flask API æœåŠ¡ |
| **å¸¸é‡é…ç½®** | `constants.py` | åº”ç”¨é…ç½® |
| **ExifToolç®¡ç†** | `exiftool_manager.py` | EXIF å¤„ç† |
| **æ›´æ–°æ£€æŸ¥** | `update_checker.py` | ç‰ˆæœ¬æ£€æŸ¥ |

### 2ï¸âƒ£ å¿…é¡»æ‰“åŒ…çš„æ¨¡å‹æ–‡ä»¶

| æ¨¡å‹ | è·¯å¾„ | å¤§å° | è¯´æ˜ |
|------|------|------|------|
| **YOLOåˆ†å‰²** | `models/yolo11l-seg.pt` | ~50MB | é¸Ÿç±»æ£€æµ‹ |
| **é¸Ÿçœ¼æ£€æµ‹** | `models/SuperEyes.pt` | ~10MB | çœ¼ç›æ£€æµ‹ |
| **é£ç‰ˆæ£€æµ‹** | `models/SuperFlier.pt` | ~10MB | é£è¡Œå§¿æ€ |
| **ç¾å­¦è¯„åˆ†** | `models/topiq-fr-pipal.onnx` | ~20MB | TOPIQ ç¾å­¦ |
| **è¯†é¸Ÿæ¨¡å‹** â­ | `birdid/models/birdid2024.pt.enc` | ~22MB | é¸Ÿç±»è¯†åˆ« (åŠ å¯†) |

### 3ï¸âƒ£ å¿…é¡»æ‰“åŒ…çš„æ•°æ®æ–‡ä»¶

| æ•°æ® | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| **é¸Ÿç±»ä¿¡æ¯** | `birdid/data/birdinfo.json` | é¸Ÿç±»ä¸­è‹±æ–‡å |
| **é¸Ÿç±»æ•°æ®åº“** | `birdid/data/bird_reference.sqlite` | ç‰©ç§æ•°æ®åº“ |
| **eBirdåœ°åŒº** | `birdid/data/ebird_regions.json` | åœ°åŒºåˆ—è¡¨ |
| **eBirdæ˜ å°„** | `birdid/data/ebird_classid_mapping.json` | ç±»åˆ«æ˜ å°„ |
| **ç¦»çº¿eBird** | `birdid/data/offline_ebird_data/` | ç¦»çº¿ç‰©ç§æ•°æ® |
| **è¯­è¨€åŒ…** | `locales/` | ä¸­è‹±æ–‡æœ¬åœ°åŒ– |

### 4ï¸âƒ£ å¿…é¡»æ‰“åŒ…çš„å¤–éƒ¨å·¥å…·

| å·¥å…· | è·¯å¾„ | å¹³å° | è¯´æ˜ |
|------|------|------|------|
| **ExifTool** | `exiftool_bundle/` | macOS/Windows | EXIF è¯»å†™ |

### 5ï¸âƒ£ Lightroom æ’ä»¶ â­ (æ–°å¢)

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| **æ’ä»¶ç›®å½•** | `SuperBirdIDPlugin.lrplugin/` | å®Œæ•´æ’ä»¶ |
| - Info.lua | | æ’ä»¶å…ƒä¿¡æ¯ |
| - PluginInit.lua | | åˆå§‹åŒ– |
| - SuperBirdIDExportServiceProvider.lua | | å¯¼å‡ºæœåŠ¡ |
| - LibraryMenuItem.lua | | å›¾åº“èœå• |

---

## ğŸš« ä¸æ‰“åŒ…çš„å†…å®¹

| ç±»åˆ« | æ–‡ä»¶/ç›®å½• | åŸå›  |
|------|----------|------|
| **è™šæ‹Ÿç¯å¢ƒ** | `.venv/` | ç”¨æˆ·æœºå™¨ä¸éœ€è¦ |
| **Git** | `.git/`, `.github/` | ç‰ˆæœ¬æ§åˆ¶ |
| **ç¼“å­˜** | `__pycache__/`, `*.pyc` | ä¸´æ—¶æ–‡ä»¶ |
| **æ„å»ºäº§ç‰©** | `build/`, `dist/` | æ—§æ„å»º |
| **æµ‹è¯•æ–‡ä»¶** | `tests/`, `test_*.py` | å¼€å‘ç”¨ |
| **æ–‡æ¡£æº** | `docs/*.md` (å¤§éƒ¨åˆ†) | å¼€å‘æ–‡æ¡£ |
| **ç¤ºä¾‹å›¾ç‰‡** | `img/`, `testimg/` | æµ‹è¯•å›¾ç‰‡ |
| **å‘å¸ƒè¯´æ˜** | `release_notes_*.md` | å†å²è®°å½• |
| **å¼€å‘è®¡åˆ’** | `V4.0_Development_Plan.md` | å¼€å‘æ–‡æ¡£ |
| **æ—¥å¿—æ–‡ä»¶** | `*.log` | è¿è¡Œæ—¥å¿— |
| **IDEé…ç½®** | `.vscode/`, `.idea/` | ç¼–è¾‘å™¨ |
| **ä¸´æ—¶æ–‡ä»¶** | `*.tmp`, `*.bak` | ä¸´æ—¶æ–‡ä»¶ |

---

## ğŸ› ï¸ æ‰“åŒ…æµç¨‹

### macOS æ‰“åŒ…æµç¨‹ (PKG + DMG)

```
1. PyInstaller æ‰“åŒ…
   â”œâ”€â”€ ç”Ÿæˆ SuperPicky.app
   â””â”€â”€ åŒ…å«æ‰€æœ‰ä¾èµ–å’Œèµ„æº

2. åˆ›å»º PKG ç»„ä»¶åŒ…
   â”œâ”€â”€ pkg_root/Applications/SuperPicky.app
   â”œâ”€â”€ pkg_scripts/postinstall (å®‰è£…åè„šæœ¬)
   â”‚   â”œâ”€â”€ è®¾ç½®æƒé™
   â”‚   â”œâ”€â”€ å®‰è£… Lightroom æ’ä»¶ â­
   â”‚   â””â”€â”€ æ¸…é™¤éš”ç¦»æ ‡è®°
   â””â”€â”€ pkgbuild ç”Ÿæˆç»„ä»¶åŒ…

3. åˆ›å»º Distribution PKG
   â”œâ”€â”€ æ¬¢è¿é¡µé¢ (welcome.html)
   â”œâ”€â”€ è®¸å¯åè®® (LICENSE.txt)
   â”œâ”€â”€ å®Œæˆé¡µé¢ (conclusion.html)
   â””â”€â”€ productbuild ç”Ÿæˆæœ€ç»ˆ PKG

4. å°† PKG æ‰“åŒ…è¿› DMG
   â”œâ”€â”€ dmg_temp/SuperPicky_Installer.pkg
   â”œâ”€â”€ dmg_temp/ä½¿ç”¨è¯´æ˜.txt (å¯é€‰)
   â””â”€â”€ hdiutil åˆ›å»º DMG

5. ç­¾åå’Œå…¬è¯
   â”œâ”€â”€ codesign ç­¾å PKG
   â”œâ”€â”€ notarytool æäº¤å…¬è¯
   â””â”€â”€ stapler è£…è®¢ç¥¨æ®
```

### postinstall è„šæœ¬æ ¸å¿ƒé€»è¾‘

```bash
#!/bin/bash

# 1. è®¾ç½®åº”ç”¨æƒé™
chmod -R 755 "/Applications/SuperPicky.app"

# 2. è®¾ç½® ExifTool å¯æ‰§è¡Œæƒé™
EXIFTOOL_PATH="/Applications/SuperPicky.app/Contents/Frameworks/exiftool_bundle/exiftool"
chmod +x "$EXIFTOOL_PATH"

# 3. å®‰è£… Lightroom æ’ä»¶ â­
LR_PLUGIN_DIR="$HOME/Library/Application Support/Adobe/Lightroom/Modules"
PLUGIN_SOURCE="/Applications/SuperPicky.app/Contents/Resources/SuperBirdIDPlugin.lrplugin"

mkdir -p "$LR_PLUGIN_DIR"
rm -rf "$LR_PLUGIN_DIR/SuperBirdIDPlugin.lrplugin"  # åˆ é™¤æ—§ç‰ˆ
cp -R "$PLUGIN_SOURCE" "$LR_PLUGIN_DIR/"

echo "âœ“ Lightroom æ’ä»¶å·²å®‰è£…åˆ°: $LR_PLUGIN_DIR"

# 4. æ¸…é™¤éš”ç¦»æ ‡è®°
xattr -cr "/Applications/SuperPicky.app"

echo "âœ… SuperPicky V4.0.0 å®‰è£…å®Œæˆ"
exit 0
```

---

## ğŸ“Š ä¾èµ–åº“æ¸…å•

### Python æ ¸å¿ƒä¾èµ–

| åº“ | ç‰ˆæœ¬ | ç”¨é€” |
|---|------|------|
| `PySide6` | 6.x | GUI æ¡†æ¶ |
| `torch` | 2.x | æ·±åº¦å­¦ä¹  |
| `torchvision` | 0.x | å›¾åƒå¤„ç† |
| `ultralytics` | 8.x | YOLO |
| `onnxruntime` | 1.x | ONNX æ¨ç† |
| `numpy` | 1.x | æ•°å€¼è®¡ç®— |
| `opencv-python` | 4.x | å›¾åƒå¤„ç† |
| `Pillow` | 10.x | å›¾åƒåŠ è½½ |
| `rawpy` | 0.x | RAW å¤„ç† |
| `flask` | 3.x | API æœåŠ¡ |
| `requests` | 2.x | HTTP è¯·æ±‚ |
| `cryptography` | 43.x | æ¨¡å‹è§£å¯† |

### PyInstaller é…ç½®è¦ç‚¹

```python
# SuperPicky.spec å…³é”®é…ç½®

a = Analysis(
    ['main.py'],
    pathex=[],
    binaries=[],
    datas=[
        ('models', 'models'),
        ('birdid/models', 'birdid/models'),
        ('birdid/data', 'birdid/data'),
        ('locales', 'locales'),
        ('exiftool_bundle', 'exiftool_bundle'),
        ('SuperBirdIDPlugin.lrplugin', 'SuperBirdIDPlugin.lrplugin'),  # â­ æ–°å¢
        ('icon.icns', '.'),
    ],
    hiddenimports=[
        'PySide6.QtCore',
        'PySide6.QtGui',
        'PySide6.QtWidgets',
        'ultralytics',
        'onnxruntime',
        'flask',
        'cryptography',
    ],
    ...
)
```

---

## ğŸ–¥ï¸ Windows æ‰“åŒ…è€ƒè™‘

### æ‰“åŒ…æ ¼å¼é€‰æ‹©

| æ ¼å¼ | å·¥å…· | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| **Inno Setup** â­ | iscc | æˆç†Ÿã€çµæ´»ã€ä¸­æ–‡æ”¯æŒå¥½ | éœ€è¦å•ç‹¬å®‰è£… |
| **NSIS** | makensis | å…è´¹ã€åŠŸèƒ½å¼ºå¤§ | è„šæœ¬è¯­æ³•å¤æ‚ |
| **WiX MSI** | wix | Windows åŸç”Ÿæ ¼å¼ | å­¦ä¹ æ›²çº¿é™¡å³­ |

### Inno Setup è„šæœ¬è¦ç‚¹

```iss
[Setup]
AppName=SuperPicky
AppVersion=4.0.0
DefaultDirName={autopf}\SuperPicky
DefaultGroupName=SuperPicky

[Files]
Source: "dist\SuperPicky\*"; DestDir: "{app}"; Flags: recursesubdirs

; Lightroom æ’ä»¶
Source: "SuperBirdIDPlugin.lrplugin\*"; DestDir: "{userappdata}\Adobe\Lightroom\Modules\SuperBirdIDPlugin.lrplugin"; Flags: recursesubdirs

[Run]
; é¦–æ¬¡è¿è¡Œè®¾ç½®
Filename: "{app}\SuperPicky.exe"; Description: "å¯åŠ¨ SuperPicky"; Flags: postinstall nowait
```

---

## âœ… æ‰“åŒ…å‰æ£€æŸ¥æ¸…å•

### ä»£ç æ£€æŸ¥
- [x] æ‰€æœ‰ç‰ˆæœ¬å·æ›´æ–°åˆ° 4.0.0
- [x] Commit hash æ›´æ–°åˆ° 0f6b496
- [ ] è¿è¡Œæµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸
- [ ] æ£€æŸ¥æ— è°ƒè¯•ä»£ç æ®‹ç•™

### èµ„æºæ£€æŸ¥
- [ ] æ‰€æœ‰æ¨¡å‹æ–‡ä»¶å­˜åœ¨
- [ ] æ‰€æœ‰æ•°æ®æ–‡ä»¶å­˜åœ¨
- [ ] ExifTool å¯æ‰§è¡Œ
- [ ] Lightroom æ’ä»¶å®Œæ•´

### æ–‡æ¡£æ£€æŸ¥
- [ ] README.md å·²æ›´æ–°
- [ ] åˆ›å»º release_notes_v4.0.0.md
- [ ] æ›´æ–°è¯´æ˜æ–‡æ¡£

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. **è¿è¡Œ GUI éªŒè¯** - ç¡®è®¤ç‰ˆæœ¬å·æ˜¾ç¤ºæ­£ç¡®
2. **æµ‹è¯• Lightroom æ’ä»¶** - ç¡®è®¤åŠŸèƒ½æ­£å¸¸
3. **åˆ›å»ºæ‰“åŒ…è„šæœ¬** - `create_pkg_dmg_v4.0.0.sh`
4. **æ‰§è¡Œæ‰“åŒ…** - ç”Ÿæˆå®‰è£…åŒ…
5. **ç­¾åå…¬è¯** - æäº¤ Apple å…¬è¯
6. **ä¸Šä¼ å‘å¸ƒ** - GitHub Releases

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-18
